<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Builder - INF Dashboard</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="stylesheet" href="styles.css?v=1">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Header Bar Styles */
        .page-header {
            width: 100vw;
            background: #ffffff;
            border-bottom: 1px solid #e5e7eb;
            padding: 16px 40px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-sizing: border-box;
            height: auto;
            min-height: 65px;
        }

        .page-title {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 16px;
            font-weight: 500;
            color: #000000;
            margin-top: 5px !important;
            margin-left: -20px;
            position: relative;
            top: 5px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
        }

        .header-action-btn {
            height: 40px;
            padding: 0 12px;
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            position: relative;
            white-space: nowrap;
        }

        .header-action-btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
        }

        .header-action-btn i,
        .header-action-btn svg {
            width: 16px !important;
            height: 16px !important;
            color: #374151;
        }

        .header-logo {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .header-logo-image {
            height: 36px;
            width: auto;
            object-fit: contain;
        }

        .header-logo-text {
            font-size: 18px;
            font-weight: 700;
            color: #000000;
            text-decoration: none;
        }

        /* Secondary Sidebar Styles */
        .secondary-sidebar {
            position: fixed !important;
            left: 0 !important;
            top: 0 !important;
            bottom: 0 !important;
            width: 230px !important;
            height: 100vh !important;
            display: flex !important;
            flex-direction: column;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff !important;
            z-index: 999 !important;
            border-right: 1px solid #e5e7eb;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.05);
            visibility: visible !important;
            opacity: 1 !important;
            overflow: hidden !important;
            padding-top: 70px !important; /* Added for header */
        }

        .secondary-sidebar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
        }

        .secondary-sidebar-brand {
            font-weight: 700;
            font-size: 16px;
            color: #000000;
            letter-spacing: -0.02em;
        }

        .secondary-sidebar-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .secondary-sidebar-icon svg {
            color: #6b7280;
        }

        .secondary-sidebar-nav {
            flex: 1;
            padding: 16px 0;
            overflow-y: auto;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .secondary-sidebar-nav::-webkit-scrollbar {
            display: none;
        }

        .secondary-nav-back {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 24px;
            color: #000000;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            position: relative;
            border-radius: 8px;
            margin: 0 8px;
        }

        .secondary-nav-back:hover {
            color: #000000;
            background-color: #f9fafb;
        }

        .secondary-nav-back.active {
            background-color: #f3f4f6;
            border-radius: 8px;
        }

        .secondary-nav-list {
            margin-top: 8px;
        }

        .sidebar-divider {
            height: 1px;
            background-color: #e5e7eb;
            margin: 0 24px 12px 24px;
        }

        .sidebar-section-header {
            font-size: 12px;
            font-weight: 600;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
            padding-left: 24px;
        }

        .secondary-nav-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 24px;
            color: #000000;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s, border-radius 0.2s;
            position: relative;
            border-radius: 8px;
            margin: 0 8px;
        }

        .secondary-nav-item:hover {
            background-color: #f9fafb;
            border-radius: 8px;
        }

        .secondary-nav-item.active {
            background-color: #f3f4f6;
            border-radius: 8px;
        }

        /* Remove tile effect from dashboard-main */
        .dashboard-main {
            border-radius: 0 !important;
            box-shadow: none !important;
            margin: 0 !important;
            margin-left: 230px !important;
            position: relative !important;
            padding-top: 80px !important;
            padding-bottom: 150px !important;
        }

        /* Ensure body doesn't have padding that causes content to show behind sidebar */
        body.dashboard-page {
            padding-left: 0 !important;
            margin-left: 0 !important;
            overflow-x: hidden !important;
        }

        /* Ensure no content appears behind sidebar - add a cover */
        body.dashboard-page::before {
            content: '';
            position: fixed;
            left: 0;
            top: 0;
            width: 230px;
            height: 100vh;
            background: #ffffff;
            z-index: 998;
            pointer-events: none;
        }

        /* Dock Styles */
        .dock-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            padding: 20px;
            z-index: 1000;
            pointer-events: none;
            overflow: visible;
        }

        .dock {
            display: flex;
            align-items: flex-end;
            gap: 16px;
            background: #f9fafb;
            border-radius: 24px;
            padding: 16px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
            pointer-events: auto;
            max-width: fit-content;
            min-height: 64px;
            overflow-x: auto;
            overflow-y: visible;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .dock::-webkit-scrollbar {
            display: none;
        }

        .dock-item {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: width 0.15s cubic-bezier(0.25, 0.46, 0.45, 0.94), 
                        height 0.15s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        transform 0.15s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            flex-shrink: 0;
            will-change: width, height;
            overflow: visible;
        }

        .dock-icon {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            transition: transform 0.2s;
            background: #ffffff;
            border: 2px solid transparent;
        }

        .dock-item:hover .dock-icon {
            transform: scale(1.1);
        }

        .dock-item.active .dock-icon {
            border: 2px solid #3b82f6;
            box-shadow: none !important;
            filter: none !important;
        }

        .dock-item.active .dock-icon i,
        .dock-item.active .dock-icon svg {
            color: #3b82f6;
        }

        .dock-item.chats .dock-icon {
            background: #ffffff;
        }

        /* Override blue-shade classes to use white background */
        .dock-icon.blue-shade-1,
        .dock-icon.blue-shade-2,
        .dock-icon.blue-shade-3,
        .dock-icon.blue-shade-4,
        .dock-icon.blue-shade-5,
        .dock-icon.blue-shade-6,
        .dock-icon.blue-shade-7,
        .dock-icon.blue-shade-8 {
            background: #ffffff !important;
        }

        .dock-label {
            position: absolute;
            bottom: calc(100% + 12px);
            left: 50%;
            transform: translateX(-50%);
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 12px;
            color: #374151;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s, transform 0.2s;
            z-index: 1001;
        }

        .dock-item:hover .dock-label {
            opacity: 1;
            transform: translateX(-50%) translateY(-4px);
        }

        .dock-icon i,
        .dock-icon svg {
            width: 60%;
            height: 60%;
            color: #374151;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .dock-icon img {
            width: 60%;
            height: 60%;
            object-fit: contain;
            border-radius: 6px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Blue shades for dock buttons */
        .blue-shade-1 { background: #38bdf8; }
        .blue-shade-2 { background: #60a5fa; }
        .blue-shade-3 { background: #0ea5e9; }
        .blue-shade-4 { background: #3b82f6; }
        .blue-shade-5 { background: #0284c7; }
        .blue-shade-6 { background: #2563eb; }
        .blue-shade-7 { background: #1d4ed8; }
        .blue-shade-8 { background: #1e40af; }


        /* Style Oceanbase icon (Oceanbase.1.jpg) to match Teams icon behavior */
        .dock-item:has(img[src="oceanbase.1.jpg"]) .dock-icon,
        .dock-item:has(img[src="Oceanbase.1.jpg"]) .dock-icon {
            background: #ffffff !important;
            border: 2px solid transparent !important;
            box-shadow: none !important;
            border-radius: 12px !important;
            overflow: hidden; /* Ensure any image overflow is hidden */
        }
        
        .dock-item:has(img[src="oceanbase.1.jpg"]) .dock-icon img,
        .dock-item:has(img[src="Oceanbase.1.jpg"]) .dock-icon img {
            /* Scale up to push internal border out */
            /* translate(-50%, -50%) is required to keep it centered as per global dock styles */
            transform: translate(-50%, -50%) scale(1.2);
            /* Grayscale for inactive state */
            filter: grayscale(100%);
            transition: filter 0.15s ease, transform 0.15s ease;
        }
        
        /* Blue (Original) when active page or pressed */
        .dock-item.active:has(img[src="oceanbase.1.jpg"]) .dock-icon img,
        .dock-item:has(img[src="oceanbase.1.jpg"]):active .dock-icon img,
        .dock-item.active:has(img[src="Oceanbase.1.jpg"]) .dock-icon img,
        .dock-item:has(img[src="Oceanbase.1.jpg"]):active .dock-icon img {
            /* Show original blue image */
            filter: none;
            /* Keep scaling to hide border, centered */
            transform: translate(-50%, -50%) scale(1.2);
        }
        
        .dock-item:has(img[src="oceanbase.1.jpg"]):active .dock-icon img,
        .dock-item:has(img[src="Oceanbase.1.jpg"]):active .dock-icon img {
            /* Slightly reduce scale on press, but keep enough to hide border, centered */
            transform: translate(-50%, -50%) scale(1.15);
        }
        
        .dock-item:has(img[src="oceanbase.1.jpg"]):active .dock-icon,
        .dock-item:has(img[src="Oceanbase.1.jpg"]):active .dock-icon {
            transform: scale(0.95);
        }
        
        .dock-item.active:has(img[src="oceanbase.1.jpg"]) .dock-icon,
        .dock-item.active:has(img[src="Oceanbase.1.jpg"]) .dock-icon {
            border: 2px solid #3b82f6 !important;
            background: #ffffff !important;
            box-shadow: none !important;
            border-radius: 12px !important;
        }

        .database-highlight::after {
            display: none !important;
        }

        .database-highlight .btn-secondary {
            border-color: #d1d5db !important;
        }

        .database-highlight .btn-secondary:hover {
            border-color: #9ca3af !important;
            color: #1f2937 !important;
        }

        .database-highlight .btn-primary {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
        }

        /* Change database tiles from blue to white */
        .database-tile {
            background: #ffffff !important;
            border: 1px solid #e5e7eb !important;
        }

        .database-tile::after {
            display: none !important;
        }

        .database-tile-icon {
            background: #f3f4f6 !important;
            color: #1f2937 !important;
        }

        .database-tile-icon.alt {
            background: #f3f4f6 !important;
            color: #1f2937 !important;
        }

        .database-tile-icon.highlight {
            background: #f3f4f6 !important;
            color: #1f2937 !important;
        }
    </style>
</head>
<body class="dashboard-page database-page">
    <!-- Header Bar -->
    <header class="page-header">
        <div class="page-title">Database Builder</div>
        <div class="header-logo">
            <img src="INF.Asset1.png" alt="INFINIFY" class="header-logo-image">
            <a href="home.html" class="header-logo-text">INFINIFY SUITE</a>
        </div>
        <div class="header-actions">
            <button class="header-action-btn" id="appsDropdownBtn">
                <i data-lucide="grid-3x3"></i>
                <span>App's</span>
            </button>
            <button class="header-action-btn" id="bellDropdownBtn">
                <i data-lucide="bell"></i>
            </button>
            <button class="header-action-btn" id="accountDropdownBtn">
                <i data-lucide="user"></i>
            </button>
        </div>
    </header>


    <!-- Secondary Sidebar -->
    <div class="secondary-sidebar">
        <div class="secondary-sidebar-nav">
            <div class="secondary-nav-list">
                <div class="secondary-nav-back active" onclick="window.location.href='Oceanbase/overview.html'">
                    <span>Overview</span>
                </div>
                <div class="secondary-nav-item" data-nav="client-table" onclick="window.location.href='Oceanbase/client-table.html'">
                    <span>Client table</span>
                </div>
                <div class="secondary-nav-item" data-nav="queries">
                    <span>Queries</span>
                </div>
                <div class="secondary-nav-item" data-nav="reports">
                    <span>Reports</span>
                </div>
                <div class="secondary-nav-item" data-nav="connections" onclick="window.location.href='Oceanbase/connections.html'">
                    <span>Connections</span>
                </div>
                <div class="secondary-nav-item" data-nav="settings">
                    <span>Settings</span>
                </div>
            </div>

            <div style="height: 100px;"></div>
            <div class="sidebar-divider"></div>
            <div class="sidebar-section-header">BASES</div>
            <div class="secondary-nav-list">
                <div class="secondary-nav-item">
                    <span>Chat 1</span>
                </div>
                <div class="secondary-nav-item">
                    <span>Chat 2</span>
                </div>
            </div>
        </div>
    </div>
        
    <!-- Main Content -->
    <main class="dashboard-main database-main" style="padding: 40px; min-height: 100vh; background: #ffffff;">
        <div class="database-container">
                    <!-- Main Content Area -->
                    <div class="database-content" style="width: 100%; background: transparent; box-shadow: none; border-radius: 0;">
                        <!-- Highlight Tile -->
                        <section class="database-highlight">
                            <div class="database-highlight-left">
                                <h2>Database Builder</h2>
                                <p>Spin up collaborative tables, design forms, and automate workflows across your teams in minutes.</p>
                            </div>
                            <div class="database-highlight-actions">
                                <button class="btn-primary" onclick="databaseBuilder.openWizard()">Create Database</button>
                                <button class="btn-secondary" onclick="databaseManager.showImport()">Import Data</button>
                            </div>
                        </section>

                        <section class="database-quick-tiles">
                            <div class="database-tile">
                                <div class="database-tile-icon">
                                    <i data-lucide="sparkles"></i>
                                </div>
                                <div class="database-tile-body">
                                    <h3>AI Templates</h3>
                                    <p>Jump-start with curated table layouts for CRM, finance, and operations.</p>
                                </div>
                                <button class="btn-secondary btn-pill" onclick="databaseBuilder.openWizard()">Browse Templates</button>
                            </div>

                            <div class="database-tile">
                                <div class="database-tile-icon alt">
                                    <i data-lucide="layers"></i>
                                </div>
                                <div class="database-tile-body">
                                    <h3>Sync Sources</h3>
                                    <p>Connect spreadsheets, APIs, or Supabase tables for live data sync.</p>
                                </div>
                                <button class="btn-secondary btn-pill" onclick="databaseManager.showImport()">Set up Sync</button>
                            </div>

                            <div class="database-tile">
                                <div class="database-tile-icon highlight">
                                    <img src="work.2.png" alt="Teams" style="width: 32px; height: 32px; object-fit: contain; border-radius: 6px;">
                                </div>
                                <div class="database-tile-body">
                                    <h3>Collaborate</h3>
                                    <p>Invite teams, manage permissions, and automate reviews with guardrails.</p>
                                </div>
                                <button class="btn-secondary btn-pill" onclick="databaseManager.showSharing()">Share Access</button>
                            </div>
                        </section>

                        <!-- View Toggle -->
                        <div class="view-toggle" id="view-toggle">
                            <button class="toggle-btn active" data-view="table" onclick="databaseManager.setView('table')">
                                üìä Table View
                            </button>
                            <button class="toggle-btn" data-view="form" onclick="databaseManager.setView('form')">
                                üìù Form View
                            </button>
                            <div class="view-actions">
                                <button class="btn-secondary btn-small" onclick="databaseManager.showFilters()" id="filter-btn">
                                    üîç Filter
                                </button>
                                <button class="btn-secondary btn-small" onclick="databaseManager.showImport()" id="import-btn">
                                    üì• Import
                                </button>
                                <button class="btn-secondary btn-small" onclick="databaseManager.showReports()" id="report-btn">
                                    üìä Reports
                                </button>
                                <button class="btn-secondary btn-small" onclick="databaseManager.showSharing()" id="share-btn">
                                    üîó Share
                                </button>
                            </div>
                        </div>

                        <!-- Empty State -->
                        <div class="database-empty-state" id="database-empty-state">
                            <div class="empty-state-content">
                                <h2>Welcome to Database Builder</h2>
                                <p>Create simple databases for your data. Perfect for contacts, inventory, recipes, and more.</p>
                                <button class="btn-primary btn-large" onclick="databaseBuilder.openWizard()">
                                    ‚ûï Create Your First Database
                                </button>
                            </div>
                        </div>

                        <!-- Table View -->
                        <div class="table-view-container" id="table-view" style="display: none;">
                            <!-- Populated by table-view.js -->
                        </div>

                        <!-- Form View -->
                        <div class="form-view-container" id="form-view" style="display: none;">
                            <!-- Populated by form-view.js -->
                        </div>
                    </div>
                </div>
        </div>
    </main>
        
    <!-- Dock -->
    <div class="dock-container">
        <div class="dock" id="dock">
            <div class="dock-item" onclick="window.location.href='home.html'">
                <div class="dock-icon blue-shade-4">
                    <i data-lucide="home"></i>
                </div>
                <div class="dock-label">Home</div>
            </div>
            <div class="dock-item" onclick="window.location.href='operation.html'">
                <div class="dock-icon blue-shade-5">
                    <i data-lucide="hard-hat"></i>
                </div>
                <div class="dock-label">Operation</div>
            </div>
            <div class="dock-item" onclick="window.location.href='work.html'">
                <div class="dock-icon blue-shade-3">
                    <img src="work.2.png" alt="Teams">
                </div>
                <div class="dock-label">Teams</div>
            </div>
            <div class="dock-item" onclick="window.location.href='Agents.html'">
                <div class="dock-icon blue-shade-6">
                    <i data-lucide="cpu"></i>
                </div>
                <div class="dock-label">Agents</div>
            </div>
            <div class="dock-item" onclick="window.location.href='Kreative.html'">
                <div class="dock-icon blue-shade-2">
                    <img src="Kreative.png" alt="Kreative">
                </div>
                <div class="dock-label">Kreative</div>
            </div>
            <div class="dock-item" onclick="window.location.href='Devra.html'">
                <div class="dock-icon blue-shade-7">
                    <i data-lucide="squares-exclude"></i>
                </div>
                <div class="dock-label">Devra</div>
            </div>
            <div class="dock-item" onclick="window.location.href='campaigns.html'">
                <div class="dock-icon blue-shade-1">
                    <i data-lucide="focus"></i>
                </div>
                <div class="dock-label">Campaigns</div>
            </div>
            <div class="dock-item active" onclick="window.location.href='Oceanbase.html'">
                <div class="dock-icon">
                    <img src="oceanbase.1.jpg" alt="Database">
                </div>
                <div class="dock-label">Oceanbase</div>
            </div>
            <div class="dock-item" onclick="window.location.href='Online-assets.html'">
                <div class="dock-icon blue-shade-4">
                    <i data-lucide="container"></i>
                </div>
                <div class="dock-label">Online Assets</div>
            </div>
            <div class="dock-item" onclick="window.location.href='Filebase.html'">
                <div class="dock-icon blue-shade-6">
                    <i data-lucide="folder-tree"></i>
                </div>
                <div class="dock-label">Filebase</div>
            </div>
            <div class="dock-item" onclick="window.location.href='financial.html'">
                <div class="dock-icon blue-shade-5">
                    <i data-lucide="landmark"></i>
                </div>
                <div class="dock-label">Financials</div>
            </div>
            <div class="dock-item chats" onclick="window.location.href='chats.html'">
                <div class="dock-icon">
                    <i data-lucide="message-square"></i>
                </div>
                <div class="dock-label">Chats</div>
            </div>
        </div>
    </div>

    <!-- Circle in bottom right corner -->
    <div style="position: fixed; bottom: 20px; right: 20px; width: 45px; height: 45px; border-radius: 50%; box-shadow: 0 4px 12px rgba(96, 165, 250, 0.3); z-index: 1000; overflow: hidden;">
        <img src="sorif.1.jpg" alt="Sorif" style="width: 100%; height: 100%; object-fit: cover;">
    </div>

    <!-- Database Builder Wizard Modal -->
    <div class="wizard-modal" id="database-wizard" style="display: none;">
        <div class="wizard-modal-content">
            <div class="wizard-close" onclick="databaseBuilder.closeWizard()">√ó</div>
            <div id="wizard-container">
                <!-- Populated by database-builder.js -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- AWS Cognito -->
    <script src="https://unpkg.com/amazon-cognito-identity-js@6.3.0/dist/amazon-cognito-identity.min.js"></script>
    <script src="cognito-config.js"></script>
    <script src="cognito-auth.js"></script>
    <script src="navigation-handler.js"></script>
    <script src="templates.js"></script>
    <script src="client-database-service.js"></script>
    <script src="backup-service.js"></script>
    <script src="database-builder.js"></script>
    <script src="table-view.js"></script>
    <script src="form-view.js"></script>
    <script src="import-service.js"></script>
    <script src="view-builder.js"></script>
    <script src="report-generator.js"></script>
    <script src="sharing-service.js"></script>
    <script src="storage-service.js"></script>
    <script src="realtime-service.js"></script>
    
    <script>
        // Database Manager - Coordinates all components
        class DatabaseManager {
            constructor() {
                this.currentView = 'table';
                this.currentTableName = null;
                this.currentTableSchema = null;
            }

            async init() {
                // Initialize wizard
                if (window.databaseBuilder) {
                    window.databaseBuilder.init('wizard-container');
                }

                // Show empty state initially
                this.showEmptyState();
            }

            setView(view) {
                this.currentView = view;
                
                // Update toggle buttons
                document.querySelectorAll('.toggle-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.view === view) {
                        btn.classList.add('active');
                    }
                });

                // Show/hide views
                const tableView = document.getElementById('table-view');
                const formView = document.getElementById('form-view');
                const emptyState = document.getElementById('database-empty-state');

                if (this.currentTableName && this.currentTableSchema) {
                    tableView.style.display = view === 'table' ? 'block' : 'none';
                    formView.style.display = view === 'form' ? 'block' : 'none';
                    emptyState.style.display = 'none';

                    // Initialize the selected view
                    if (view === 'table' && window.tableView) {
                        window.tableView.init(this.currentTableName, this.currentTableSchema, 'table-view');
                    } else if (view === 'form' && window.formView) {
                        window.formView.init(this.currentTableName, this.currentTableSchema, 'form-view');
                    }
                } else {
                    this.showEmptyState();
                }
            }

            async loadDatabase(database) {
                if (!database) {
                    this.showEmptyState();
                    return;
                }

                // Show empty state until a table is selected
                this.showEmptyState();
            }

            async loadTable(tableName, tableSchema) {
                if (!tableName || !tableSchema) {
                    this.showEmptyState();
                    return;
                }

                this.currentTableName = tableName;
                this.currentTableSchema = tableSchema;

                // Hide empty state
                document.getElementById('database-empty-state').style.display = 'none';

                // Show view toggle
                document.getElementById('view-toggle').style.display = 'flex';

                // Load the current view
                this.setView(this.currentView);
            }

            showFilters() {
                if (this.currentTableSchema && window.viewBuilder) {
                    window.viewBuilder.showFilterBuilder(this.currentTableSchema, (filters) => {
                        if (window.tableView) {
                            window.tableView.setFilters(filters);
                        }
                    });
                }
            }

            showImport() {
                if (!this.currentTableName || !this.currentTableSchema) {
                    alert('Please select a table first');
                    return;
                }

                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.csv,.xlsx,.xls';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file && window.importService) {
                        window.importService.handleFileSelect(
                            file,
                            this.currentTableSchema,
                            null,
                            () => {
                                // Reload table data after import
                                if (window.tableView) {
                                    window.tableView.loadData().then(() => {
                                        window.tableView.render();
                                    });
                                }
                            }
                        );
                    }
                };
                input.click();
            }

            showReports() {
                if (!this.currentTableName || !this.currentTableSchema) {
                    alert('Please select a table first');
                    return;
                }

                if (window.tableView && window.reportGenerator) {
                    const data = window.tableView.data || [];
                    window.reportGenerator.showReportModal(data, this.currentTableSchema);
                }
            }

            showSharing() {
                if (!this.currentDatabase) {
                    alert('Please select a database first');
                    return;
                }

                if (window.sharingService) {
                    window.sharingService.showSharingModal(
                        this.currentDatabase.id,
                        this.currentDatabase.name
                    );
                }
            }

            async loadDatabase(database) {
                this.currentDatabase = database;
                if (!database) {
                    this.showEmptyState();
                    return;
                }
                // Show empty state until a table is selected
                this.showEmptyState();
            }

            showEmptyState() {
                document.getElementById('database-empty-state').style.display = 'flex';
                document.getElementById('table-view').style.display = 'none';
                document.getElementById('form-view').style.display = 'none';
                document.getElementById('view-toggle').style.display = 'none';
                this.currentTableName = null;
                this.currentTableSchema = null;
            }

            clearContent() {
                this.showEmptyState();
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize Lucide icons
            if (window.lucide) lucide.createIcons();

            // Initialize navigation
            if (typeof initNavigation === 'function') {
                initNavigation();
            }

            // Bottom dock magnification effect
            const dock = document.getElementById('dock');
            if (dock) {
                const dockItems = dock.querySelectorAll('.dock-item');
                dockItems.forEach(item => {
                    item.addEventListener('mouseenter', function() {
                        const baseSize = 40;
                        const hoverSize = 56;
                        dockItems.forEach((other, index) => {
                            if (other === item) {
                                other.style.width = hoverSize + 'px';
                                other.style.height = hoverSize + 'px';
                            } else {
                                other.style.width = baseSize + 'px';
                                other.style.height = baseSize + 'px';
                            }
                        });
                    });
                    item.addEventListener('mouseleave', function() {
                        dockItems.forEach(other => {
                            if (!other.classList.contains('active')) {
                                other.style.width = '';
                                other.style.height = '';
                            }
                        });
                    });
                });
            }

            // Initialize database manager
            const databaseManager = new DatabaseManager();
            window.databaseManager = databaseManager;
            await databaseManager.init();

            // Initialize share access if accessed via share link
            if (window.sharingService) {
                await window.sharingService.initShareAccess();
            }
        });
    </script>
</body>
</html>

