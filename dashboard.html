<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INF Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="dashboard-page">
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="#">
                    <img src="INF.logo2.png" alt="INF Logo" class="inf-logo-img">
                </a>
                <div class="nav-logo-line"></div>
            </div>
            <ul class="nav-menu">
                <li><a href="dashboard.html" class="nav-link active">Suite</a></li>
            </ul>
            <div class="nav-search">
                <form id="navSearchForm">
                    <input class="search-input" type="search" placeholder="Search..." aria-label="Search" />
                    <button class="search-btn" type="submit" title="Search">
                        <i data-lucide="search"></i>
                    </button>
                </form>
            </div>
            <div class="nav-actions">
                <button class="icon-btn" title="Chat">
                    <i data-lucide="message-circle"></i>
                </button>
                <button class="icon-btn" title="Settings">
                    <i data-lucide="settings"></i>
                </button>
            </div>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>


    <!-- Vertical Dock -->
    <div class="vertical-dock">
        <div class="dock-logo">
            <img src="INF.logo3.png" alt="INF Logo" class="dock-logo-img">
        </div>
        <div class="dock-items">
            <div class="dock-item active" onclick="window.location.href='home.html'">
                <i data-lucide="home"></i>
                <span class="dock-label">Home</span>
            </div>
            <div class="dock-item" onclick="window.location.href='Agents.html'">
                <i data-lucide="cpu"></i>
                <span class="dock-label">Agents</span>
            </div>
            <div class="dock-item" onclick="window.location.href='teams.html'">
                <i data-lucide="users"></i>
                <span class="dock-label">Team's</span>
            </div>
            <div class="dock-item" onclick="window.location.href='chats.html'">
                <i data-lucide="message-circle-plus"></i>
                <span class="dock-label">Chats</span>
            </div>
            <div class="dock-item" onclick="window.location.href='Marketplace.html'">
                <i data-lucide="store"></i>
                <span class="dock-label">Marketplace</span>
            </div>
            <div class="dock-item" onclick="window.location.href='my-apps.html'">
                <i data-lucide="grid-3x3"></i>
                <span class="dock-label">My apps</span>
            </div>
            <div class="dock-item" onclick="window.location.href='Leads-marketing.html'">
                <i data-lucide="focus"></i>
                <span class="dock-label">Leads &amp; Marketing</span>
            </div>
            <div class="dock-item" onclick="window.location.href='Database.html'">
                <img src="oceanbase.1.jpg" alt="Database" style="width: 32px; height: 32px; object-fit: contain; border-radius: 6px;">
                <span class="dock-label">Data</span>
            </div>
            <div class="dock-item" onclick="window.location.href='social-assets.html'">
                <i data-lucide="container"></i>
                <span class="dock-label">Social assets</span>
            </div>
            <div class="dock-item" onclick="window.location.href='Filebase.html'">
                <i data-lucide="files"></i>
                <span class="dock-label">Filebase</span>
            </div>
            <div class="dock-item" onclick="window.location.href='financial.html'">
                <i data-lucide="landmark"></i>
                <span class="dock-label">Financials</span>
            </div>
            <div class="dock-item" onclick="window.location.href='CreatePro.html'">
                <i data-lucide="image-upscale"></i>
                <span class="dock-label">Account</span>
            </div>
        </div>
    </div>


    <!-- Main Content -->
    <main class="dashboard-main">
        <div class="dashboard-container">
            <!-- App slots (row above all tiles) -->
            <section class="apps-grid">
                <div class="card app-card">
                    <div class="app-card-inner">
                        <div class="app-icon"></div>
                        <div class="app-meta">
                            <div class="app-name">App Slot 1</div>
                            <div class="app-sub">Add details</div>
                        </div>
                    </div>
                </div>
                <div class="card app-card">
                    <div class="app-card-inner">
                        <div class="app-icon"></div>
                        <div class="app-meta">
                            <div class="app-name">App Slot 2</div>
                            <div class="app-sub">Add details</div>
                        </div>
                    </div>
                </div>
                <div class="card app-card">
                    <div class="app-card-inner">
                        <div class="app-icon"></div>
                        <div class="app-meta">
                            <div class="app-name">App Slot 3</div>
                            <div class="app-sub">Add details</div>
                        </div>
                    </div>
                </div>
                <div class="card app-card">
                    <div class="app-card-inner">
                        <div class="app-icon"></div>
                        <div class="app-meta">
                            <div class="app-name">App Slot 4</div>
                            <div class="app-sub">Add details</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Teams layout copy -->
            <section class="tiles-grid">
                <div class="tiles-row row-1">
                <div class="card chart-card">
                    <div class="card-header">
                        <h3 class="card-title">Team Performance</h3>
                        <div class="card-meta">2025 <i data-lucide="chevron-down"></i></div>
                    </div>
                    <div class="chart-wrap">
                        <canvas id="teamPerformanceChart" height="160"></canvas>
                    </div>
                </div>

                <div class="card teams-card">
                    <div class="card-header">
                        <h3 class="card-title">My Team's</h3>
                        <a class="link-view-all" href="#">View All</a>
                    </div>
                    <ul class="team-list">
                        <li class="team-item">
                            <div class="avatar avatar-pink">LC</div>
                            <div class="member-meta">
                                <div class="member-name">Liam Carter</div>
                                <div class="member-role">Creative Interface Specialist</div>
                            </div>
                            <button class="icon-kebab" title="More">
                                <i data-lucide="more-vertical"></i>
                            </button>
                        </li>
                        <li class="team-item">
                            <div class="avatar avatar-purple">MT</div>
                            <div class="member-meta">
                                <div class="member-name">Mia Thompson</div>
                                <div class="member-role">User Experience Architect</div>
                            </div>
                            <button class="icon-kebab" title="More">
                                <i data-lucide="more-vertical"></i>
                            </button>
                        </li>
                        <li class="team-item">
                            <div class="avatar avatar-blue">NJ</div>
                            <div class="member-meta">
                                <div class="member-name">Noah Johnson</div>
                                <div class="member-role">Visual Design Expert</div>
                            </div>
                            <button class="icon-kebab" title="More">
                                <i data-lucide="more-vertical"></i>
                            </button>
                        </li>
                        <li class="team-item">
                            <div class="avatar avatar-yellow">EW</div>
                            <div class="member-meta">
                                <div class="member-name">Emma Wilson</div>
                                <div class="member-role">Interaction Designer</div>
                            </div>
                            <button class="icon-kebab" title="More">
                                <i data-lucide="more-vertical"></i>
                            </button>
                        </li>
                    </ul>
                </div>
                </div>

                <div class="tiles-row row-2">
                <div class="card projects-card">
                    <div class="card-header">
                        <h3 class="card-title">Latest Projects</h3>
                        <a class="link-view-all" href="#">View All</a>
                    </div>
                    <div class="project-list">
                        <article class="project-item">
                            <div class="project-top">
                                <div class="project-left">
                                    <div class="project-meta">
                                        <div class="project-title">Quantum Leap Redesign</div>
                                        <div class="project-client">Client: John Doe</div>
                                    </div>
                                </div>
                                <div class="project-right">
                                    <button class="icon-kebab" title="More"><i data-lucide="more-vertical"></i></button>
                                    <div class="progress-label">60%</div>
                                </div>
                            </div>
                            <div class="project-footer">
                                <div class="progress-bar progress-wide"><span style="width:60%"></span></div>
                            </div>
                        </article>
                        <article class="project-item">
                            <div class="project-top">
                                <div class="project-left">
                                    <div class="project-meta">
                                        <div class="project-title">Phoenix App</div>
                                        <div class="project-client">Client: Sarah Summers</div>
                                    </div>
                                </div>
                                <div class="project-right">
                                    <button class="icon-kebab" title="More"><i data-lucide="more-vertical"></i></button>
                                    <div class="progress-label">60%</div>
                                </div>
                            </div>
                            <div class="project-footer">
                                <div class="progress-bar progress-wide"><span style="width:60%"></span></div>
                            </div>
                        </article>
                    </div>
                </div>

                <div class="card chart-card">
                    <div class="card-header">
                        <h3 class="card-title">Monthly Goal Stats</h3>
                        <div class="card-meta">June <i data-lucide="chevron-down"></i></div>
                    </div>
                    <div class="goal-grid">
                        <ul class="goal-legend">
                            <li><span class="dot" style="--c:#60a5fa"></span> Quantum Leap</li>
                            <li><span class="dot" style="--c:#9ca3af"></span> Nebula Nexus</li>
                            <li><span class="dot" style="--c:#93c5fd"></span> Echo System</li>
                            <li><span class="dot" style="--c:#3b82f6"></span> Phoenix App</li>
                        </ul>
                        <div class="chart-wrap"><canvas id="goalPieChart" height="200"></canvas></div>
                    </div>
                </div>
                </div>
            </section>

            
        </div>
        <!-- Circle in bottom right corner -->
        <div style="position: fixed; bottom: 20px; right: 20px; width: 45px; height: 45px; border-radius: 50%; box-shadow: 0 4px 12px rgba(96, 165, 250, 0.3); z-index: 1000; overflow: hidden;">
            <img src="sorif.1.jpg" alt="Sorif" style="width: 100%; height: 100%; object-fit: cover;">
        </div>
    </main>

    <!-- Productivity Panel: Todos & Notes -->
    <aside id="productivityPanel" class="productivity-panel fullscreen" aria-label="Todos and Notes">
        <div class="panel-header">
            <h3 class="panel-title">Workspace</h3>
        </div>

        <section class="sidebar-section" aria-labelledby="todosHeading">
            <div class="section-header">
                <h4 id="todosHeading" class="section-title">Todos</h4>
                <button class="add-btn" title="Add todo">
                    <i data-lucide="plus"></i>
                </button>
            </div>
            <div class="todo-list">
                <div class="todo-item">
                    <input type="checkbox" />
                    <div class="todo-text">Donate $500 to the charity</div>
                </div>
                <div class="todo-item">
                    <input type="checkbox" />
                    <div class="todo-text">Do 500 pushups</div>
                </div>
                <div class="todo-item">
                    <input type="checkbox" checked />
                    <div class="todo-text">Buy new headset</div>
                </div>
                <div class="todo-item">
                    <input type="checkbox" />
                    <div class="todo-text">Clean the room</div>
                </div>
            </div>
        </section>

        <section class="sidebar-section" aria-labelledby="notesHeading">
            <div class="section-header">
                <h4 id="notesHeading" class="section-title">Notes</h4>
                <button class="add-btn" title="Add note">
                    <i data-lucide="plus"></i>
                </button>
            </div>

            <div class="notes-list">
                <article class="note-card">
                    <div class="note-date">Today</div>
                    <h5 class="note-title">UI: Sidebar divider hidden</h5>
                    <p class="note-content">The vertical divider between the left sidebar and the productivity panel is intentionally hidden (border-left set to transparent) per design request. Adjust in styles.css under .productivity-panel if needed.</p>
                </article>
                <article class="note-card">
                    <div class="note-date">Apr 2, 2023</div>
                    <h5 class="note-title">ChatGPT Tricks for business marketing</h5>
                    <p class="note-content">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut id dui mi.</p>
                </article>
                <article class="note-card">
                    <div class="note-date">Apr 3, 2023</div>
                    <h5 class="note-title">How to plan football without breaking bones</h5>
                    <p class="note-content">Fusce varius bibendum ante, non lacinia. Nullam vitae mi ac nunc varius.</p>
                </article>
                <article class="note-card">
                    <div class="note-date">Apr 4, 2023</div>
                    <h5 class="note-title">What are my life goals and progress</h5>
                    <p class="note-content">Suspendisse potenti. Etiam nec nunc sed urna fermentum tincidunt.</p>
                </article>
            </div>
        </section>
    </aside>


    <script src="script.js"></script>
    <!-- AWS Cognito -->
    <script src="https://unpkg.com/amazon-cognito-identity-js@6.3.0/dist/amazon-cognito-identity.min.js"></script>
    <script src="cognito-config.js"></script>
    <script src="cognito-auth.js"></script>
    <script src="database-service.js"></script>
    <script>
        // Dashboard Data Manager
        class DashboardDataManager {
            constructor() {
                this.teamPerformanceChart = null;
                this.goalPieChart = null;
                this.teams = [];
                this.projects = [];
            }

            async init() {
                // Initialize UI
                if (window.lucide) lucide.createIcons();

                const dockItems = Array.from(document.querySelectorAll('.dock-item'));
                dockItems.forEach(item => {
                    item.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            item.click();
                        }
                    });

                    const label = item.querySelector('.dock-label');
                    if (label) {
                        item.addEventListener('mouseenter', () => {
                            const rect = item.getBoundingClientRect();
                            label.style.top = `${rect.top + rect.height / 2 - 100}px`;
                        });
                    }
                });

                // Load data from database
                await this.loadDashboardData();
            }

            async loadDashboardData() {
                try {
                    // Load teams
                    await this.loadTeams();
                    
                    // Load projects
                    await this.loadProjects();
                    
                    // Load performance metrics
                    await this.loadPerformanceMetrics();
                    
                    // Load app slots
                    await this.loadAppSlots();
                    
                    // Load todos and notes
                    await this.loadTodos();
                    await this.loadNotes();
                } catch (error) {
                    console.error('Error loading dashboard data:', error);
                }
            }

            async loadTeams() {
                if (!window.databaseService) return;

                try {
                    const { data: teams, error } = await window.databaseService.getTeams();
                    if (error) throw error;

                    this.teams = teams || [];
                    
                    // Load team members for first team
                    if (this.teams.length > 0) {
                        const teamId = this.teams[0].id;
                        const { data: members } = await window.databaseService.getTeamMembers(teamId);
                        this.renderTeamMembers(members || []);
                    } else {
                        // Show default/empty state
                        this.renderTeamMembers([]);
                    }
                } catch (error) {
                    console.error('Error loading teams:', error);
                    this.renderTeamMembers([]);
                }
            }

            renderTeamMembers(members) {
                const teamList = document.querySelector('.team-list');
                if (!teamList) return;

                if (members.length === 0) {
                    // Show default placeholder data if no members
                    teamList.innerHTML = `
                        <li class="team-item">
                            <div class="avatar avatar-pink">LC</div>
                            <div class="member-meta">
                                <div class="member-name">Liam Carter</div>
                                <div class="member-role">Creative Interface Specialist</div>
                            </div>
                            <button class="icon-kebab" title="More">
                                <i data-lucide="more-vertical"></i>
                            </button>
                        </li>
                        <li class="team-item">
                            <div class="avatar avatar-purple">MT</div>
                            <div class="member-meta">
                                <div class="member-name">Mia Thompson</div>
                                <div class="member-role">User Experience Architect</div>
                            </div>
                            <button class="icon-kebab" title="More">
                                <i data-lucide="more-vertical"></i>
                            </button>
                        </li>
                    `;
                } else {
                    const avatarColors = ['avatar-pink', 'avatar-purple', 'avatar-blue', 'avatar-yellow'];
                    teamList.innerHTML = members.slice(0, 4).map((member, index) => {
                        const profile = member.profiles || {};
                        const name = profile.full_name || profile.email || 'Unknown';
                        const initials = name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
                        const role = member.role || 'Team Member';
                        const colorClass = avatarColors[index % avatarColors.length];
                        
                        return `
                            <li class="team-item">
                                <div class="avatar ${colorClass}">${initials}</div>
                                <div class="member-meta">
                                    <div class="member-name">${name}</div>
                                    <div class="member-role">${role}</div>
                                </div>
                                <button class="icon-kebab" title="More">
                                    <i data-lucide="more-vertical"></i>
                                </button>
                            </li>
                        `;
                    }).join('');
                }

                // Reinitialize icons
                if (window.lucide) lucide.createIcons();
            }

            async loadProjects() {
                if (!window.databaseService) return;

                try {
                    const { data: projects, error } = await window.databaseService.getProjects();
                    if (error) throw error;

                    this.projects = projects || [];
                    this.renderProjects(this.projects.slice(0, 2)); // Show latest 2
                    this.updateGoalChart(this.projects);
                } catch (error) {
                    console.error('Error loading projects:', error);
                    this.renderProjects([]);
                }
            }

            renderProjects(projects) {
                const projectList = document.querySelector('.project-list');
                if (!projectList) return;

                if (projects.length === 0) {
                    // Show default placeholder
                    projectList.innerHTML = `
                        <article class="project-item">
                            <div class="project-top">
                                <div class="project-left">
                                    <div class="project-meta">
                                        <div class="project-title">Quantum Leap Redesign</div>
                                        <div class="project-client">Client: John Doe</div>
                                    </div>
                                </div>
                                <div class="project-right">
                                    <button class="icon-kebab" title="More"><i data-lucide="more-vertical"></i></button>
                                    <div class="progress-label">60%</div>
                                </div>
                            </div>
                            <div class="project-footer">
                                <div class="progress-bar progress-wide"><span style="width:60%"></span></div>
                            </div>
                        </article>
                    `;
                } else {
                    projectList.innerHTML = projects.map(project => {
                        const progress = project.progress || 0;
                        return `
                            <article class="project-item">
                                <div class="project-top">
                                    <div class="project-left">
                                        <div class="project-meta">
                                            <div class="project-title">${project.name || 'Untitled Project'}</div>
                                            <div class="project-client">Client: ${project.client_name || 'N/A'}</div>
                                        </div>
                                    </div>
                                    <div class="project-right">
                                        <button class="icon-kebab" title="More"><i data-lucide="more-vertical"></i></button>
                                        <div class="progress-label">${progress}%</div>
                                    </div>
                                </div>
                                <div class="project-footer">
                                    <div class="progress-bar progress-wide"><span style="width:${progress}%"></span></div>
                                </div>
                            </article>
                        `;
                    }).join('');
                }

                // Reinitialize icons
                if (window.lucide) lucide.createIcons();
            }

            async loadPerformanceMetrics() {
                if (!window.databaseService) return;

                try {
                    // Get metrics for last 6 months
                    const endDate = new Date();
                    const startDate = new Date();
                    startDate.setMonth(startDate.getMonth() - 6);

                    const { data: metrics, error } = await window.databaseService.getPerformanceMetrics(
                        null,
                        startDate.toISOString(),
                        endDate.toISOString()
                    );

                    if (error) throw error;
                    this.updatePerformanceChart(metrics || []);
                } catch (error) {
                    console.error('Error loading performance metrics:', error);
                    // Use default data
                    this.updatePerformanceChart([]);
                }
            }

            updatePerformanceChart(metrics) {
                if (!window.Chart) return;

                const perfCtx = document.getElementById('teamPerformanceChart');
                if (!perfCtx) return;

                // Group metrics by month
                const monthlyData = {};
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
                
                metrics.forEach(metric => {
                    const date = new Date(metric.recorded_at);
                    const month = date.getMonth();
                    const monthName = months[month];
                    
                    if (!monthlyData[monthName]) {
                        monthlyData[monthName] = { progress: 0, timeSpent: 0, count: 0 };
                    }
                    
                    if (metric.metric_type === 'progress') {
                        monthlyData[monthName].progress += metric.value;
                    } else if (metric.metric_type === 'time_spent') {
                        monthlyData[monthName].timeSpent += metric.value;
                    }
                    monthlyData[monthName].count++;
                });

                // Calculate averages
                const progressData = months.map(m => {
                    const data = monthlyData[m];
                    return data && data.count > 0 ? data.progress / data.count : 0;
                });
                
                const timeSpentData = months.map(m => {
                    const data = monthlyData[m];
                    return data && data.count > 0 ? data.timeSpent / data.count : 0;
                });

                // Use default data if no metrics
                const finalProgressData = progressData.some(v => v > 0) ? progressData : [6,9,11,12,19,10];
                const finalTimeSpentData = timeSpentData.some(v => v > 0) ? timeSpentData : [6,7,12,14,6,10];

                if (this.teamPerformanceChart) {
                    this.teamPerformanceChart.destroy();
                }

                this.teamPerformanceChart = new Chart(perfCtx, {
                    type: 'line',
                    data: { 
                        labels: months, 
                        datasets: [ 
                            { 
                                label: 'Progress', 
                                data: finalProgressData, 
                                borderColor: '#60a5fa', 
                                backgroundColor: 'rgba(96,165,250,0.15)', 
                                fill: true, 
                                tension: 0.35, 
                                borderWidth: 2 
                            }, 
                            { 
                                label: 'Time Spent', 
                                data: finalTimeSpentData, 
                                borderColor: '#facc15', 
                                backgroundColor: 'rgba(250,204,21,0.15)', 
                                fill: true, 
                                tension: 0.35, 
                                borderWidth: 2 
                            } 
                        ] 
                    },
                    options: { 
                        responsive: true, 
                        plugins: { legend: { position: 'top' } }, 
                        scales: { 
                            y: { grid: { color: 'rgba(0,0,0,0.05)' } }, 
                            x: { grid: { display: false } } 
                        } 
                    }
                });
            }

            updateGoalChart(projects) {
                if (!window.Chart) return;

                const pieCtx = document.getElementById('goalPieChart');
                if (!pieCtx) return;

                if (projects.length === 0) {
                    // Use default data
                    if (this.goalPieChart) {
                        this.goalPieChart.destroy();
                    }
                    this.goalPieChart = new Chart(pieCtx, { 
                        type: 'pie', 
                        data: { 
                            labels: ['Quantum Leap','Nebula Nexus','Echo System','Phoenix App'], 
                            datasets: [{ 
                                data: [55,25,10,10], 
                                backgroundColor: ['#60a5fa','#9ca3af','#93c5fd','#3b82f6'], 
                                borderWidth: 0 
                            }] 
                        }, 
                        options: { plugins: { legend: { display: false } } } 
                    });
                    return;
                }

                // Calculate project distribution
                const labels = projects.slice(0, 4).map(p => p.name || 'Untitled');
                const data = projects.slice(0, 4).map(p => p.progress || 0);
                
                // Update legend
                const legend = document.querySelector('.goal-legend');
                if (legend) {
                    legend.innerHTML = labels.map((label, i) => {
                        const colors = ['#60a5fa', '#9ca3af', '#93c5fd', '#3b82f6'];
                        return `<li><span class="dot" style="--c:${colors[i]}"></span> ${label}</li>`;
                    }).join('');
                }

                if (this.goalPieChart) {
                    this.goalPieChart.destroy();
                }

                this.goalPieChart = new Chart(pieCtx, { 
                    type: 'pie', 
                    data: { 
                        labels: labels, 
                        datasets: [{ 
                            data: data, 
                            backgroundColor: ['#60a5fa','#9ca3af','#93c5fd','#3b82f6'], 
                            borderWidth: 0 
                        }] 
                    }, 
                    options: { plugins: { legend: { display: false } } } 
                });
            }

            async loadAppSlots() {
                if (!window.databaseService) return;

                try {
                    const { data: appSlots, error } = await window.databaseService.getAppSlots();
                    if (error) throw error;

                    if (appSlots && appSlots.length > 0) {
                        this.renderAppSlots(appSlots);
                    }
                } catch (error) {
                    console.error('Error loading app slots:', error);
                }
            }

            renderAppSlots(appSlots) {
                const appCards = document.querySelectorAll('.app-card');
                appSlots.forEach((slot, index) => {
                    if (appCards[index]) {
                        const appName = appCards[index].querySelector('.app-name');
                        const appSub = appCards[index].querySelector('.app-sub');
                        if (appName) appName.textContent = slot.app_name || `App Slot ${slot.slot_number}`;
                        if (appSub) appSub.textContent = slot.app_details || 'Add details';
                    }
                });
            }

            async loadTodos() {
                if (!window.databaseService) return;

                try {
                    const { data: todos, error } = await window.databaseService.getTodos();
                    if (error) throw error;

                    if (todos && todos.length > 0) {
                        this.renderTodos(todos);
                    }
                } catch (error) {
                    console.error('Error loading todos:', error);
                }
            }

            renderTodos(todos) {
                const todoList = document.querySelector('.todo-list');
                if (!todoList) return;

                todoList.innerHTML = todos.slice(0, 4).map(todo => `
                    <div class="todo-item">
                        <input type="checkbox" ${todo.completed ? 'checked' : ''} 
                               onchange="dashboardDataManager.toggleTodo('${todo.id}', this.checked)">
                        <div class="todo-text">${todo.content || ''}</div>
                    </div>
                `).join('');
            }

            async toggleTodo(todoId, completed) {
                if (!window.databaseService) return;
                await window.databaseService.updateTodo(todoId, { completed });
            }

            async loadNotes() {
                if (!window.databaseService) return;

                try {
                    const { data: notes, error } = await window.databaseService.getNotes();
                    if (error) throw error;

                    if (notes && notes.length > 0) {
                        this.renderNotes(notes);
                    }
                } catch (error) {
                    console.error('Error loading notes:', error);
                }
            }

            renderNotes(notes) {
                const notesList = document.querySelector('.notes-list');
                if (!notesList) return;

                notesList.innerHTML = notes.slice(0, 4).map(note => {
                    const date = new Date(note.created_at);
                    const dateStr = date.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric', 
                        year: date.getFullYear() !== new Date().getFullYear() ? 'numeric' : undefined
                    });

                    return `
                        <article class="note-card">
                            <div class="note-date">${dateStr}</div>
                            <h5 class="note-title">${note.title || 'Untitled'}</h5>
                            <p class="note-content">${note.content || ''}</p>
                        </article>
                    `;
                }).join('');
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', async () => {
            const dashboardDataManager = new DashboardDataManager();
            window.dashboardDataManager = dashboardDataManager;
            await dashboardDataManager.init();
        });
    </script>
</body>
</html>
